{% extends "base_account.html" %}
{% block title %}Haggis - View Cumulative Results{% endblock %}

{% block content %}
<h2 class="pageTitle">Cumulative Results for {{name}}</h2>

{% set assignmentTitles = [] %}
{% for assignment in assignments %}
	{% set assignmentTitles = assignmentTitles|merge([assignment.0.title]) %}
{% endfor %}

{% set titleIterator = 0 %}
{% set chartIterator = 0 %}
{% set heightIterator = 0 %}

<div align="Center">
	{% for assignment in assignmentData %}
		<h3 class="assignmentTitle">{{assignmentTitles[titleIterator]}}</h3>
		{% set titleIterator = titleIterator + 1 %}
		{% for criteria in assignment %}
			<canvas id="{{chartIterator}}" width="1000" height="{{heights[heightIterator]}}"></canvas>
			{% set heightIterator = heightIterator + 1 %}
			<script>
				var ctx = document.getElementById("{{chartIterator}}");
				{% set chartIterator = chartIterator + 1 %}
				var labels = [];
				var scores = [];
				var colors = [];
				var colorCounter = 0;
				{% for criterion in criteria %}
					{% if criterion is iterable %}
						labels.push("{{criterion.title}}");			
						scores.push({{criterion.rating}});
						if (colorCounter == 0)
						{
							colors.push('rgb(0,128,255)','rgb(192,192,192)');
							colorCounter = 1;
						}
						else
						{
							colorCounter = 0;
						}
					{% endif %}
				{% endfor %}
				var myChart = new Chart(ctx, {
				    type: 'horizontalBar',
				    data: {
				        labels: labels,
				        datasets: [{
				            label: 'Average rating',
				            data: scores,
				            backgroundColor: colors,
				        }]
				    },
				    options: {
				    	legend: {
				    		display: false
				    	},
				    	title: {
				    		display: true,
				    		fontSize: 36,
				    		text: "{{criteria.type}} total results"
				    	},
				        responsive: false,
				        responsiveAnimationDuration: 2800,
				        maintainAspectRatio: false,
				        scales: {
				            xAxes: [{
				                ticks: {
				                    beginAtZero:true
				                }
				            }]
				        }
				    } 

				});
			</script>
		{% endfor %}	{% endfor %}
</div>
{% set labels = [] %}
{% set scores = [] %}
{% endblock %}